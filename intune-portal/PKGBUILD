# Maintainer: GrzegorzKozub <grzegorz.kozub@gmail.com>

pkgname=intune-portal
pkgdesc="Intune Portal"
# url="https://packages.microsoft.com/ubuntu/24.04/prod/pool/main/i/${pkgname}"
url="https://packages.microsoft.com/ubuntu/24.04/prod/pool/main/i/intune-portal"

pkgver=1.2511.7
pkgrel=1

arch=('x86_64')
# depends=(
#   'microsoft-identity-broker'
#   'webkit2gtk-4.1'
# )

depends=("webkit2gtk" "gnome-keyring" "libsecret" "openssl")

# source=(
#   "https://packages.microsoft.com/ubuntu/24.04/prod/pool/main/i/${pkgname}/${pkgname}_${pkgver}-noble_amd64.deb"
#   'os-release'
# )
# sha256sums=(
#   '36527c9bb575c8b12b3a7b69ac7b3711a80fb704b361677b3411f48dcef6fa2e'
#   '66bac031d7251861f0f4d878a2c38f103510a74ee6435674594c67fac58ea31b'
# )

source=(
  "source.deb::$url/${pkgname}_${pkgver}-noble_amd64.deb"
  'os-release'
)
sha256sums=(
  "307bc09a47a6c76f1935c565a05371274dd86f1ae054fbc1ece38c611e8eca8f"
  '66bac031d7251861f0f4d878a2c38f103510a74ee6435674594c67fac58ea31b'
)

install=install.sh

# prepare() {
#   tar -xf data.tar.xz
# }

package() {
  ar x source.deb
  tar xJf data.tar.xz

  mkdir -p usr/bin
  [ ! -f usr/bin/intune-portal ] && ln -s ../../opt/microsoft/intune/bin/intune-portal usr/bin/intune-portal
  cp -r "$srcdir/usr" "$srcdir/opt" "$pkgdir/"
  cp -r "$srcdir/lib" "$pkgdir/usr/"
  install -Dm644 "$srcdir"/os-release -t "$pkgdir"/opt/microsoft/intune/share/
}

# package() {
#   install -d "$pkgdir"/usr/lib/systemd/{system,user}
#   install -d "$pkgdir"/opt/microsoft/intune/{bin,share}
#   install -d "$pkgdir"/usr/lib/{tmpfiles.d,/security}
#   install -Dm644 "$srcdir"/usr/share/pam-configs/intune -t "$pkgdir"/etc/pam.d/
#   install -Dm644 "$srcdir"/usr/lib/x86_64-linux-gnu/security/pam_intune.so -t "$pkgdir"/usr/lib/security/
#   install -Dm644 "$srcdir"/usr/lib/tmpfiles.d/intune.conf -t "$pkgdir"/usr/lib/tmpfiles.d/
#   install -Dm644 "$srcdir"/usr/share/applications/intune-portal.desktop -t "$pkgdir"/usr/share/applications/
#   install -Dm644 "$srcdir"/usr/share/icons/hicolor/48x48/apps/intune.png -t "$pkgdir"/usr/share/icons/hicolor/48x48/apps/
#   install -Dm644 "$srcdir"/usr/share/polkit-1/actions/com.microsoft.intune.policy -t "$pkgdir"/usr/share/polkit-1/actions/
#   install -Dm644 "$srcdir"/usr/share/doc/intune-portal/copyright -t "$pkgdir"/usr/share/doc/intune-portal/
#   install -Dm644 "$srcdir"/lib/systemd/system/* "$pkgdir"/usr/lib/systemd/system/
#   install -Dm644 "$srcdir"/lib/systemd/user/* "$pkgdir"/usr/lib/systemd/user/
#   install -Dm755 "$srcdir"/opt/microsoft/intune/bin/* "$pkgdir"/opt/microsoft/intune/bin/
#   install -Dm644 "$srcdir"/os-release -t "$pkgdir"/opt/microsoft/intune/share/
#   cp -r "$srcdir"/opt/microsoft/intune/share/* "$pkgdir"/opt/microsoft/intune/share/
# }
